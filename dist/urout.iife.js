var urout=function(t){"use strict";function e(t,e){if(t instanceof RegExp)return{keys:!1,pattern:t};var r,s,n,a,h=[],i="",o=t.split("/");for(o[0]||o.shift();n=o.shift();)"*"===(r=n[0])?(h.push("wild"),i+="/(.*)"):":"===r?(s=n.indexOf("?",1),a=n.indexOf(".",1),h.push(n.substring(1,~s?s:~a?a:n.length)),i+=~s&&!~a?"(?:/([^/]+?))?":"/([^/]+?)",~a&&(i+=(~s?"?":"")+"\\"+n.substring(a))):i+="/"+n;return{keys:h,pattern:new RegExp("^"+i+(e?"(?=$|/)":"/?$"),"i")}}function r(t,e){return Object.prototype.hasOwnProperty.call(t,e)}var s;function n(t,e){let r=t.url;if(null==r)return;let n=t._parsedUrl;if(n&&n.raw===r)return n;let a,h=r,i="";if(r.length>1){let n=r.indexOf("?",1);if(-1!==n&&(i=r.substring(n),h=r.substring(0,n),i.length>1&&(a=s(i.substring(1)))),e&&!t._decoded&&(t._decoded=!0,-1!==h.indexOf("%")))try{h=decodeURIComponent(h)}catch(o){}}return t._parsedUrl={pathname:h,search:i,query:a,raw:r}}function a(t,e,r){"string"==typeof t?r.end(t):r.end(t.message)}s=function(t,e,s,n){e=e||"&",s=s||"=";var a={};if("string"!=typeof t||0===t.length)return a;var h=/\+/g;t=t.split(e);var i=1e3;n&&"number"==typeof n.maxKeys&&(i=n.maxKeys);var o=t.length;i>0&&o>i&&(o=i);for(var l=0;l<o;++l){var d,u,p,c,f=t[l].replace(h,"%20"),g=f.indexOf(s);g>=0?(d=f.substr(0,g),u=f.substr(g+1)):(d=f,u=""),p=decodeURIComponent(d),c=decodeURIComponent(u),r(a,p)?Array.isArray(a[p])?a[p].push(c):a[p]=[a[p],c]:a[p]=c}return a};const h=t=>t instanceof i?t.attach:t;class i extends class{constructor(){this.routes=[],this.all=this.add.bind(this,""),this.get=this.add.bind(this,"GET"),this.head=this.add.bind(this,"HEAD"),this.patch=this.add.bind(this,"PATCH"),this.options=this.add.bind(this,"OPTIONS"),this.connect=this.add.bind(this,"CONNECT"),this.delete=this.add.bind(this,"DELETE"),this.trace=this.add.bind(this,"TRACE"),this.post=this.add.bind(this,"POST"),this.put=this.add.bind(this,"PUT")}use(t,...r){let s=[].concat.apply([],r),{keys:n,pattern:a}=e(t,!0);return this.routes.push({keys:n,pattern:a,method:"",handlers:s}),this}add(t,r,...s){let{keys:n,pattern:a}=e(r),h=[].concat.apply([],s);return this.routes.push({keys:n,pattern:a,method:t,handlers:h}),this}find(t,e){let r,s,n="HEAD"===t,a=0,h=0,i=this.routes,o=[],l={},d=[];for(;a<i.length;a++)if(s=i[a],0===s.method.length||s.method===t||n&&"GET"===s.method)if(!1===s.keys){if(o=s.pattern.exec(e),null===o)continue;if(void 0!==o.groups)for(r in o.groups)l[r]=o.groups[r];s.handlers.length>1?d=d.concat(s.handlers):d.push(s.handlers[0])}else if(s.keys.length>0){if(o=s.pattern.exec(e),null===o)continue;for(h=0;h<s.keys.length;)l[s.keys[h]]=o[++h];s.handlers.length>1?d=d.concat(s.handlers):d.push(s.handlers[0])}else s.pattern.test(e)&&(s.handlers.length>1?d=d.concat(s.handlers):d.push(s.handlers[0]));return{params:l,handlers:d}}}{constructor(t={}){super(),this.parse=n,this.handler=this.handler.bind(this),this.onError=t.onError||a,this.onNoMatch=t.onNoMatch||this.onError.bind(null,{code:404}),this.attach=(t,e)=>setTimeout(this.handler,0,t,e)}use(t,...e){return"/"===t?super.use(t,...e.map(h)):"function"==typeof t||t instanceof i?super.use("/",...[t,...e].map(h)):super.use(t,((e,r,s)=>{if("string"==typeof t){let r=t.length;t.startsWith("/")||r++,e.url=e.url.substring(r)||"/",e.path=e.path&&e.path.substring(r)||"/"}else e.url=e.url.replace(t,"")||"/",e.path=e.path&&e.path.replace(t,"")||"/";"/"!==e.url.charAt(0)&&(e.url="/"+e.url),s()}),...e.map(h),((t,e,r)=>{var s,n;t.path=(null==(s=t._parsedUrl)?void 0:s.pathname)||"",t.url=t.path+(null==(n=t._parsedUrl)?void 0:n.search)||"",r()})),this}handler(t,e,r){let s=this.parse(t,!0),n=this.find(t.method,t.path=s.pathname);if(t.params=n.params,t.originalUrl=t.originalUrl||t.url,t.url=s.pathname+s.search,t.query=s.query||{},t.search=s.search,t.routePath="",t.params){let e=t.originalUrl;for(const[r,s]of Object.entries(t.params))e=e.replace(s,`:${r}`);t.routePath=e.replace(t.search,"")}try{let s=0,a=n.handlers.concat(this.onNoMatch),h=a.length,i=async()=>e.finished||s<h&&a[s++](t,e,r);(r=r||(s=>s?this.onError(s,t,e,r):i().catch(r)))()}catch(a){this.onError(a,t,e,r)}}}return t.Router=i,Object.defineProperty(t,"__esModule",{value:!0}),t[Symbol.toStringTag]="Module",t}({});
