function t(t,n){if(t instanceof RegExp)return{keys:[],pattern:t};var e,r,s,i,h=[],a="",o=t.split("/");for(o[0]||o.shift();s=o.shift();)"*"===(e=s[0])?(h.push("wild"),a+="/(.*)"):":"===e?(r=s.indexOf("?",1),i=s.indexOf(".",1),h.push(s.substring(1,~r?r:~i?i:s.length)),a+=~r&&!~i?"(?:/([^/]+?))?":"/([^/]+?)",~i&&(a+=(~r?"?":"")+"\\"+s.substring(i))):a+="/"+s;return{keys:h,pattern:new RegExp("^"+a+(n?"(?=$|/)":"/?$"),"i")}}var n=function(t,n){var e=t.url;if(null!=e){var r=t._parsedUrl;if(r&&r._raw===e)return r;if(r={path:e,pathname:e,search:null,query:null,href:e,_raw:e},e.length>1){n&&!t._decoded&&~e.indexOf("%",1)&&(e=t.url=r.href=r.path=r.pathname=r._raw=decodeURIComponent(e),t._decoded=!0);var s=e.indexOf("?",1);-1!==s&&(r.search=e.substring(s),r.query=r.search.substring(1),r.pathname=e.substring(0,s),n&&r.query.length>0&&(r.query=function(t){for(var n,e={},s=r.query.split("&"),i=0,h=void 0,a=void 0;i<s.length;i++)a=void 0===(a=(n=s[i].split("="))[1])?"":a,e[h=n[0]]=void 0!==e[h]?[].concat(e[h],a):a;return e}()))}return t._parsedUrl=r}},e=function(t){var e=this;void 0===t&&(t={}),this.routes=[],this.parse=n,this.handler=this.handler.bind(this),this.onError=t.onError||this.onErrorI,this.onNoMatch=t.onNoMatch||this.onError.bind(null,{code:404}),this.attach=function(t,n){return setTimeout(e.handler,0,t,n)},this.all=this.add.bind(this,""),this.get=this.add.bind(this,"GET"),this.head=this.add.bind(this,"HEAD"),this.patch=this.add.bind(this,"PATCH"),this.options=this.add.bind(this,"OPTIONS"),this.connect=this.add.bind(this,"CONNECT"),this.delete=this.add.bind(this,"DELETE"),this.trace=this.add.bind(this,"TRACE"),this.post=this.add.bind(this,"POST"),this.put=this.add.bind(this,"PUT")};e.prototype.useI=function(n){for(var e=[],r=arguments.length-1;r-- >0;)e[r]=arguments[r+1];var s=[].concat.apply([],e),i=t(n,!0);return this.routes.push({keys:i.keys,pattern:i.pattern,method:"",handlers:s}),this},e.prototype.use=function(t){for(var n,r,s,i=[],h=arguments.length-1;h-- >0;)i[h]=arguments[h+1];return"function"==typeof t?(n=this).useI.apply(n,["/",t].concat(i)):"/"===t?(r=this).useI.apply(r,[t].concat(i)):(s=this).useI.apply(s,[t,function(n,e,r){if("string"==typeof t){var s=t.length;0===t.indexOf("/")||s++,n.url=n.url.substring(s)||"/",n.path=n.path.substring(s)||"/"}else n.url=n.url.replace(t,"")||"/",n.path=n.path.replace(t,"")||"/";r()}].concat(i.map(function(t){return t instanceof e?t.attach:t}),[function(t,n,e){t.url=t._parsedUrl.href,t.path=t._parsedUrl.pathname,e()}])),this},e.prototype.onErrorI=function(t,n,e){e.statusCode=t.code||t.status||500,e.end(t.length&&t||t.message)},e.prototype.add=function(n,e){for(var r=[],s=arguments.length-2;s-- >0;)r[s]=arguments[s+2];var i=t(e),h=i.keys,a=i.pattern,o=[].concat.apply([],r);return this.routes.push({keys:h,pattern:a,method:n,handlers:o}),this},e.prototype.handler=function(t,n,e){var r=this,s=this.parse(t,!0),i=this.find(t.method,t.path=s.pathname);t.params=i.params,t.originalUrl=t.originalUrl||t.url,t.query=s.query||{},t.search=s.search;try{var h=0,a=i.handlers.concat(this.onNoMatch),o=a.length,d=function(){return n.finished||h<o&&a[h++](t,n,e)};e=e||function(s){return s?r.onError(s,t,n,e):d()},d()}catch(r){this.onError(r,t,n,e)}},e.prototype.find=function(t,n){for(var e,r,s="HEAD"===t,i=0,h=0,a=this.routes,o=[],d={},u=[];i<a.length;i++)if(0===(r=a[i]).method.length||r.method===t||s&&"GET"===r.method)if(0==r.keys.length){if(null===(o=r.pattern.exec(n)))continue;if(void 0!==o.groups)for(e in o.groups)d[e]=o.groups[e];r.handlers.length>1?u=u.concat(r.handlers):u.push(r.handlers[0])}else if(r.keys.length>0){if(null===(o=r.pattern.exec(n)))continue;for(h=0;h<r.keys.length;)d[r.keys[h]]=o[++h];r.handlers.length>1?u=u.concat(r.handlers):u.push(r.handlers[0])}else r.pattern.test(n)&&(r.handlers.length>1?u=u.concat(r.handlers):u.push(r.handlers[0]));return{params:d,handlers:u}};export{e as Router};
